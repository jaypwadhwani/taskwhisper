<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TaskWhisper - Voice Memo Email Scheduler</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: .5; }
    }
    .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .animate-spin { animation: spin 1s linear infinite; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    function TaskWhisper() {
      const [isRecording, setIsRecording] = useState(false);
      const [memos, setMemos] = useState([]);
      const [currentTranscript, setCurrentTranscript] = useState('');
      const [isEditingTranscript, setIsEditingTranscript] = useState(false);
      const [userEmail, setUserEmail] = useState('');
      const [fromEmail, setFromEmail] = useState(localStorage.getItem('fromEmail') || '');
      const [scheduleDate, setScheduleDate] = useState('');
      const [notificationMethod, setNotificationMethod] = useState(['email']);
      const [phoneNumber, setPhoneNumber] = useState('');
      const [recordingTime, setRecordingTime] = useState(0);
      const [isDarkMode, setIsDarkMode] = useState(false);
      const [showToast, setShowToast] = useState(false);
      const [isTranscribing, setIsTranscribing] = useState(false);
      
      const timerRef = useRef(null);
      const scheduleRef = useRef(null);
      const mediaRecorderRef = useRef(null);
      const audioChunksRef = useRef([]);

      useEffect(() => {
        return () => {
          if (timerRef.current) clearInterval(timerRef.current);
        };
      }, []);

      const startRecording = async () => {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          mediaRecorderRef.current = new MediaRecorder(stream);
          audioChunksRef.current = [];

          mediaRecorderRef.current.ondataavailable = (event) => {
            audioChunksRef.current.push(event.data);
          };

          mediaRecorderRef.current.onstop = () => {
            const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/wav' });
            stream.getTracks().forEach(track => track.stop());
            simulateTranscription(); // In real app, send audioBlob to backend for transcription
          };

          mediaRecorderRef.current.start();
          setIsRecording(true);
          setRecordingTime(0);
          
          timerRef.current = setInterval(() => {
            setRecordingTime(prev => prev + 1);
          }, 1000);
        } catch (err) {
          alert('Microphone access denied. Using demo mode.');
          // Fallback to demo mode
          setIsRecording(true);
          setRecordingTime(0);
          timerRef.current = setInterval(() => {
            setRecordingTime(prev => prev + 1);
          }, 1000);
        }
      };

      const stopRecording = () => {
        if (isRecording) {
          setIsRecording(false);
          if (timerRef.current) {
            clearInterval(timerRef.current);
            timerRef.current = null;
          }
          if (mediaRecorderRef.current && mediaRecorderRef.current.state !== 'inactive') {
            mediaRecorderRef.current.stop();
          } else {
            simulateTranscription();
          }
        }
      };

      const simulateTranscription = () => {
        setIsTranscribing(true);
        setTimeout(() => {
          const transcripts = [
            "Remember to follow up with the design team about the new landing page mockups by end of week.",
            "Buy groceries: milk, eggs, bread, chicken, and vegetables for the week.",
            "Call mom on Sunday afternoon to catch up and discuss holiday plans.",
            "Review the Q4 budget proposal and send feedback to finance team before Monday's meeting."
          ];
          setCurrentTranscript(transcripts[Math.floor(Math.random() * transcripts.length)]);
          setIsTranscribing(false);
          
          const today = new Date();
          const dateStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
          setScheduleDate(dateStr);
          
          setTimeout(() => scheduleRef.current?.scrollIntoView({ behavior: 'smooth' }), 300);
        }, 1500);
      };

      const scheduleMemo = () => {
        if (!currentTranscript || !scheduleDate) return alert('Please complete all fields.');
        if (notificationMethod.includes('email') && !userEmail) return alert('Please enter your recipient email.');
        if (notificationMethod.includes('email') && !fromEmail) return alert('Please enter your email address (From).');
        if (notificationMethod.includes('sms') && !phoneNumber) return alert('Please enter your phone.');

        // Save fromEmail to localStorage
        if (fromEmail) localStorage.setItem('fromEmail', fromEmail);

        setMemos([...memos, {
          id: Date.now(),
          transcript: currentTranscript,
          scheduledFor: new Date(scheduleDate),
          toEmail: userEmail,
          fromEmail: fromEmail,
          phone: phoneNumber,
          methods: [...notificationMethod]
        }]);
        
        setCurrentTranscript('');
        setScheduleDate('');
        setUserEmail('');
        setShowToast(true);
        setTimeout(() => setShowToast(false), 3000);
      };

      const isDisabled = () => {
        if (!currentTranscript || !scheduleDate) return true;
        if (notificationMethod.includes('email') && (!userEmail || !fromEmail)) return true;
        if (notificationMethod.includes('sms') && !phoneNumber) return true;
        return false;
      };

      const formatDate = (date) => new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
      const formatTime = (s) => `${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`;

      return (
        <div className={isDarkMode ? 'bg-gray-950 text-white min-h-screen' : 'bg-white min-h-screen'}>
          {showToast && (
            <div className="fixed top-6 right-6 bg-green-500 text-white px-6 py-4 rounded-lg shadow-lg z-50">
              ‚úì Reminder scheduled!
            </div>
          )}

          <header className={`border-b ${isDarkMode ? 'border-gray-800' : 'border-gray-100'} px-6 py-6`}>
            <div className="max-w-3xl mx-auto flex justify-between items-center">
              <h1 className="text-2xl font-semibold">TaskWhisper</h1>
              <button onClick={() => setIsDarkMode(!isDarkMode)} className="p-2 rounded-full hover:bg-gray-100">
                {isDarkMode ? '‚òÄÔ∏è' : 'üåô'}
              </button>
            </div>
          </header>

          <main className="max-w-3xl mx-auto px-6 py-16">
            <div className="mb-20 text-center">
              <h2 className="text-5xl font-bold mb-6">
                Capture a thought.<br/>Turn it into an email reminder.
              </h2>
              <p className={`text-xl ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                Record a voice memo and schedule when you need to hear it again.
              </p>
            </div>

            <div className={`mb-16 p-12 rounded-2xl ${isDarkMode ? 'bg-gray-900 border border-gray-800' : 'bg-gray-50 border border-gray-100'}`}>
              <div className="flex flex-col items-center">
                <button 
                  onClick={isRecording ? stopRecording : startRecording}
                  className={`w-28 h-28 rounded-full flex items-center justify-center shadow-lg hover:shadow-xl hover:scale-105 transition-all ${isRecording ? 'bg-red-500 animate-pulse' : 'bg-indigo-600 hover:bg-indigo-700'}`}
                >
                  <span className="text-white text-4xl">{isRecording ? '‚èπ' : 'üé§'}</span>
                </button>
                
                {isRecording && <div className="mt-6 text-3xl text-red-500">{formatTime(recordingTime)}</div>}
                
                <p className={`mt-6 text-lg ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                  {isRecording ? 'Recording...' : 'Tap to start recording'}
                </p>
                <p className={`mt-2 text-sm ${isDarkMode ? 'text-gray-500' : 'text-gray-500'}`}>
                  {!isRecording && 'Allow microphone access when prompted'}
                </p>
              </div>

              {isTranscribing && (
                <div className={`mt-10 pt-10 border-t ${isDarkMode ? 'border-gray-800' : 'border-gray-200'} text-center`}>
                  <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto"></div>
                  <p className="mt-3">Transcribing...</p>
                </div>
              )}

              {currentTranscript && !isTranscribing && (
                <div className={`mt-10 pt-10 border-t ${isDarkMode ? 'border-gray-800' : 'border-gray-200'}`}>
                  <div className="flex justify-between items-center mb-4">
                    <h3 className="text-sm font-semibold uppercase text-gray-500">Transcription</h3>
                    <button 
                      onClick={() => setIsEditingTranscript(!isEditingTranscript)}
                      className={`px-3 py-1.5 rounded-lg text-sm ${isDarkMode ? 'bg-gray-800 hover:bg-gray-700' : 'bg-gray-200 hover:bg-gray-300'}`}
                    >
                      {isEditingTranscript ? '‚úì Done' : '‚úèÔ∏è Edit'}
                    </button>
                  </div>
                  {isEditingTranscript ? (
                    <textarea
                      value={currentTranscript}
                      onChange={(e) => setCurrentTranscript(e.target.value)}
                      className={`w-full text-lg p-4 rounded-lg border-2 min-h-32 ${isDarkMode ? 'bg-gray-800 border-indigo-500 text-white' : 'bg-white border-indigo-600'}`}
                    />
                  ) : (
                    <p className="text-lg leading-relaxed">{currentTranscript}</p>
                  )}
                </div>
              )}
            </div>

            {currentTranscript && !isTranscribing && (
              <div ref={scheduleRef} className={`mb-16 p-12 rounded-2xl ${isDarkMode ? 'bg-gray-900 border border-gray-800' : 'bg-gray-50 border border-gray-100'}`}>
                <h3 className="text-2xl font-semibold mb-8">üìÖ Schedule your reminder</h3>
                
                <div className="mb-6">
                  <label className="block text-sm font-medium mb-3">Notification method</label>
                  <div className="flex gap-3">
                    {['email', 'sms'].map(method => (
                      <button
                        key={method}
                        onClick={() => {
                          if (notificationMethod.includes(method)) {
                            if (notificationMethod.length > 1) setNotificationMethod(notificationMethod.filter(m => m !== method));
                          } else {
                            setNotificationMethod([...notificationMethod, method]);
                          }
                        }}
                        className={`flex-1 px-4 py-3 rounded-lg border-2 ${notificationMethod.includes(method) ? 'border-indigo-600 bg-indigo-50 text-indigo-600' : 'border-gray-300'}`}
                      >
                        {method === 'email' ? 'üìß Email' : 'üí¨ SMS'}
                      </button>
                    ))}
                  </div>
                </div>

                {notificationMethod.includes('email') && (
                  <>
                    <div className="mb-6">
                      <label className="block text-sm font-medium mb-3">Your email (From)</label>
                      <input 
                        type="email"
                        value={fromEmail}
                        onChange={(e) => setFromEmail(e.target.value)}
                        placeholder="your-email@example.com"
                        className={`w-full px-4 py-3 rounded-lg border ${isDarkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-300'}`}
                      />
                      <p className="text-xs text-gray-500 mt-2">This will be saved for next time</p>
                    </div>
                    <div className="mb-6">
                      <label className="block text-sm font-medium mb-3">Send reminder to (To)</label>
                      <input 
                        type="email"
                        value={userEmail}
                        onChange={(e) => setUserEmail(e.target.value)}
                        placeholder="recipient@example.com"
                        className={`w-full px-4 py-3 rounded-lg border ${isDarkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-300'}`}
                      />
                    </div>
                  </>
                )}

                {notificationMethod.includes('sms') && (
                  <div className="mb-6">
                    <label className="block text-sm font-medium mb-3">Phone number</label>
                    <input 
                      type="tel"
                      value={phoneNumber}
                      onChange={(e) => setPhoneNumber(e.target.value)}
                      placeholder="+1 (555) 123-4567"
                      className={`w-full px-4 py-3 rounded-lg border ${isDarkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-300'}`}
                    />
                  </div>
                )}

                <div className="mb-6">
                  <label className="block text-sm font-medium mb-3">Date</label>
                  <input 
                    type="date"
                    value={scheduleDate}
                    onChange={(e) => setScheduleDate(e.target.value)}
                    className={`w-full px-4 py-3 rounded-lg border ${isDarkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-300'}`}
                  />
                </div>

                <button
                  onClick={scheduleMemo}
                  disabled={isDisabled()}
                  className={`w-full py-4 rounded-lg font-medium ${isDisabled() ? 'bg-gray-200 text-gray-400 cursor-not-allowed' : 'bg-indigo-600 hover:bg-indigo-700 text-white'}`}
                >
                  ‚úì Schedule reminder
                </button>
                
                {notificationMethod.includes('email') && (
                  <p className="text-xs text-gray-500 mt-4 text-center">
                    Note: Email sending requires backend setup. This is a frontend prototype.
                  </p>
                )}
              </div>
            )}

            {memos.length > 0 && (
              <div>
                <h3 className="text-2xl font-semibold mb-8">üïê Your scheduled reminders</h3>
                <div className="space-y-4">
                  {memos.map(memo => (
                    <div key={memo.id} className={`p-8 rounded-2xl ${isDarkMode ? 'bg-gray-900 border border-gray-800' : 'bg-gray-50 border border-gray-100'}`}>
                      <div className="flex justify-between">
                        <div className="flex-1">
                          <p className="text-lg mb-4">{memo.transcript}</p>
                          <p className="text-sm text-gray-500">
                            üìÖ {formatDate(memo.scheduledFor)} ‚Ä¢ {memo.methods.join(', ')}
                            {memo.fromEmail && <span> ‚Ä¢ From: {memo.fromEmail}</span>}
                            {memo.toEmail && <span> ‚Ä¢ To: {memo.toEmail}</span>}
                          </p>
                        </div>
                        <button 
                          onClick={() => setMemos(memos.filter(m => m.id !== memo.id))}
                          className="text-gray-400 hover:text-red-600 ml-4"
                        >
                          üóëÔ∏è
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </main>

          <footer className={`border-t ${isDarkMode ? 'border-gray-800' : 'border-gray-100'} mt-24 py-12 text-center`}>
            <p className="text-sm text-gray-500">
              Built as a portfolio project to demonstrate AI product development
            </p>
          </footer>
        </div>
      );
    }

    ReactDOM.render(<TaskWhisper />, document.getElementById('root'));
  </script>
</body>
</html>